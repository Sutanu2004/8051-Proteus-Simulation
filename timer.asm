ORG 0FFF6H ;WE USE TIMER T1 FOR INTERRUPT AND T0 FOR MULTIPLEXING
LJMP ISR

ORG 8100H
MOV DPTR, #0E803H  
MOV A,    #80H    
MOVX @DPTR, A
MOV IE,#89H
MOV TMOD,#11H
MOV TL1,#00H
MOV TH1,#0F4H
SETB TR1

MOV R0,#00H ;R0 KEEPS COUNT OF SECONDS R1 KEEPS COUNT OF MINUTES R2 KEEPS COUNT OF HOURS
MOV R1,#00H
MOV R2,#00H
MOV R3,#00H
MOV R4,#00H
MOV R5,#00H
MOV DPH, #90H
MOV DPL,#00H

DISPLAY:
;DISPLAY SECONDS
MOV DPL,#0BH
MOVX A,@DPTR
MOV B,#0AH ;B=10
DIV AB ; A=A/10 TENS DIGIT B=A%10 UNITS DIGIT
MOV R6,A
MOV R7,B

;DISPLAY TENS DIGIT

MOV DPTR,#0E801H
MOV A,#0FDH
MOV DPH,#90H
MOV A,R6
MOV DPL,A
MOVX A,@DPTR
MOV DPTR,#0E800H
MOVX @DPTR,A
MOV TL0,#0H
MOV TH0,#0FFH
ACALL DELAY

;DISPLAY UNITS DIGIT
MOV DPTR,#0E801H
MOV A,#0FEH
MOV DPH,#90H
MOV A,R7
MOV DPL,A
MOVX A,@DPTR
MOV DPTR,#0E800H
MOVX @DPTR,A
MOV TL0,#0H
MOV TH0,#0FFH
ACALL DELAY

;DISPLAY MINUTES
MOV A,DPL
ADD A,R4
MOV DPL,A
MOVX A,@DPTR
MOV B,#0AH ;B=10
DIV AB ; A=A/10 TENS DIGIT B=A%10 UNITS DIGIT
MOV R6,A
MOV R7,B

;DISPLAY TENS DIGIT

MOV DPTR,#0E801H
MOV A,#0FDH
MOV DPH,#90H
MOV A,R6
MOV DPL,A
MOVX A,@DPTR
MOV DPTR,#0E800H
MOVX @DPTR,A
MOV TL0,#0H
MOV TH0,#0FFH
ACALL DELAY

;DISPLAY UNITS DIGIT
MOV DPTR,#0E801H
MOV A,#0FEH
MOV DPH,#90H
MOV A,R7
MOV DPL,A
MOVX A,@DPTR
MOV DPTR,#0E800H
MOVX @DPTR,A
MOV TL0,#0H
MOV TH0,#0FFH
ACALL DELAY

;DISPLAY HOURS
MOV A,DPL
ADD A,R5
MOV DPL,A
MOVX A,@DPTR
MOV B,#0AH ;B=10
DIV AB ; A=A/10 TENS DIGIT B=A%10 UNITS DIGIT
MOV R6,A
MOV R7,B

;DISPLAY TENS DIGIT

MOV DPTR,#0E801H
MOV A,#0FDH
MOV DPH,#90H
MOV A,R6
MOV DPL,A
MOVX A,@DPTR
MOV DPTR,#0E800H
MOVX @DPTR,A
MOV TL0,#0H
MOV TH0,#0FFH
ACALL DELAY

;DISPLAY UNITS DIGIT
MOV DPTR,#0E801H
MOV A,#0FEH
MOV DPH,#90H
MOV A,R7
MOV DPL,A
MOVX A,@DPTR
MOV DPTR,#0E800H
MOVX @DPTR,A
MOV TL0,#0H
MOV TH0,#0FFH
ACALL DELAY

JMP DISPLAY

DELAY:
SETB TR0
REPEAT:
JNB TF0,REPEAT
CLR TF0
CLR TR0
RET

ISR:
MOV DPH,#90H
MOV DPL,#0BH
MOVX A,@DPTR
MOV R3,A
MOV DPL,#0CH
MOVX A,@DPTR
MOV R4,A
MOV DPL,#0DH
MOVX A,@DPTR
MOV R5,A

MOV A,#01
ADD A,R3
MOV R3,A
CJNE R3,#60,RESET
MOV R3,#00H
INC R4
CJNE R4,#60,RESET
MOV R4,#00H
INC R5
CJNE R5,#24,RESET
MOV R5,#00H
MOV R4,#00H
MOV R3,#00H

RESET:
MOV TMOD ,#11H
MOV TL1,#00H
MOV TH1,#0F4H
SETB TR1

END
